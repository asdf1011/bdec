<protocol>
  <reference name="varint" />

  <common>
      <sequence name="varint" value="${embedded:}" min="0">
      <choice name="embedded:">
        <sequence name="single byte" value="${value}">
          <field length="1" value="0" />
          <field name="value" length="7" type="integer" />
        </sequence>
        <sequence name="multi byte" value="${most significant:} * 128 + ${least significant:}" >
          <field length="1" value="1" />
          <field name="least significant:" length="7" type="integer" />
          <reference name="most significant:" type="varint" />
        </sequence>
      </choice>
    </sequence>

    <reference name="int32" type="varint" min="0-(1 &lt;&lt; 31)" max="(1 &lt;&lt; 31) - 1" />
  </common>
</protocol>
